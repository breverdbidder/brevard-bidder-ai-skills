<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrevardBidderAI Skills Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --cyber-green: #00ff9f; --cyber-blue: #00d4ff; }
        body { background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%); min-height: 100vh; }
        .glass { background: rgba(20, 20, 35, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(0, 255, 159, 0.2); }
        .glow { box-shadow: 0 0 20px rgba(0, 255, 159, 0.3); }
        .cyber-text { background: linear-gradient(90deg, var(--cyber-green), var(--cyber-blue)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="text-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-8 glow">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-bold cyber-text">BrevardBidderAI Skills System</h1>
                    <p class="text-gray-400 mt-1">Autonomous AI Development Intelligence ‚Ä¢ v2.0.0</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500">Last Updated</div>
                    <div id="last-update" class="text-cyan-400 font-mono">Loading...</div>
                    <div id="status" class="text-xs text-green-400 mt-1">‚óè Connected</div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="glass rounded-xl p-6 hover:glow transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Total Skills</p>
                        <p id="total-skills" class="text-4xl font-bold cyber-text mt-2">-</p>
                    </div>
                    <div class="text-5xl opacity-50">üéØ</div>
                </div>
            </div>
            <div class="glass rounded-xl p-6 hover:glow transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Success Rate</p>
                        <p id="success-rate" class="text-4xl font-bold text-green-400 mt-2">-</p>
                    </div>
                    <div class="text-5xl opacity-50">‚úÖ</div>
                </div>
                <div class="mt-3 h-2 bg-gray-700 rounded-full overflow-hidden">
                    <div id="success-bar" class="h-full bg-gradient-to-r from-green-500 to-cyan-400 transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
            <div class="glass rounded-xl p-6 hover:glow transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Time Saved</p>
                        <p id="time-saved" class="text-4xl font-bold text-purple-400 mt-2">-</p>
                    </div>
                    <div class="text-5xl opacity-50">‚è±Ô∏è</div>
                </div>
            </div>
            <div class="glass rounded-xl p-6 hover:glow transition-all">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Tasks Documented</p>
                        <p id="total-docs" class="text-4xl font-bold text-orange-400 mt-2">-</p>
                    </div>
                    <div class="text-5xl opacity-50">üìÑ</div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="glass rounded-xl p-6">
                <h2 class="text-xl font-semibold mb-4 cyber-text">Skills by Category</h2>
                <div class="h-64"><canvas id="categoryChart"></canvas></div>
            </div>
            <div class="glass rounded-xl p-6">
                <h2 class="text-xl font-semibold mb-4 cyber-text">Performance Overview</h2>
                <div class="h-64"><canvas id="performanceChart"></canvas></div>
            </div>
        </div>

        <!-- Skills Table -->
        <div class="glass rounded-xl p-6 mb-8">
            <div class="flex items-center justify-between mb-4 flex-wrap gap-4">
                <h2 class="text-xl font-semibold cyber-text">Skills Inventory</h2>
                <input type="text" id="search" placeholder="Search skills..." 
                    class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-sm focus:border-cyan-400 focus:outline-none w-full sm:w-auto">
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-left text-gray-400 text-sm border-b border-gray-700">
                            <th class="pb-3 font-medium">Skill Name</th>
                            <th class="pb-3 font-medium">Category</th>
                            <th class="pb-3 font-medium">Uses</th>
                            <th class="pb-3 font-medium">Success</th>
                            <th class="pb-3 font-medium">Time Saved</th>
                            <th class="pb-3 font-medium">Status</th>
                        </tr>
                    </thead>
                    <tbody id="skills-table"></tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-gray-500 text-sm">
            <p>Created by <span class="text-cyan-400">Ariel Shapira</span>, Solo Founder - Everest Capital USA</p>
            <p class="mt-1">BrevardBidderAI v13.4.0 | AI Skills System v2.0.0</p>
        </div>
    </div>

    <script>
        // Supabase config - embedded for autonomous operation (anon key - safe to expose)
        const SUPABASE_URL = 'https://mocerqjnksmhcjzxrewo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vY2VycWpua3NtaGNqenhyZXdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MzI1MjYsImV4cCI6MjA4MDEwODUyNn0.ySFJIOngWWB0aqYra4PoGFuqcbdHOx1ZV6T9-klKQDw';
        
        const headers = {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'Content-Type': 'application/json'
        };

        let categoryChart, performanceChart;

        async function fetchData() {
            try {
                document.getElementById('status').innerHTML = '‚óè Fetching...';
                document.getElementById('status').className = 'text-xs text-yellow-400 mt-1 pulse';
                
                // Fetch skills from insights table
                const skillsRes = await fetch(`${SUPABASE_URL}/rest/v1/insights?insight_type=eq.ai_skill&status=eq.Active`, { headers });
                const skills = await skillsRes.json();
                
                // Fetch tasks from activities table
                const tasksRes = await fetch(`${SUPABASE_URL}/rest/v1/activities?activity_type=eq.skill_task&select=id`, { headers });
                const tasks = await tasksRes.json();
                
                // Calculate metrics
                let totalUses = 0, totalTimeSaved = 0, totalSuccess = 0;
                const categoryCount = {};
                const skillsData = [];
                
                skills.forEach(s => {
                    try {
                        const data = JSON.parse(s.action_taken || '{}');
                        const uses = data.total_uses || s.recurrence_count || 0;
                        const timeSaved = (data.avg_time_saved || 0) * uses;
                        const successRate = s.confidence || 0;
                        const category = data.category || 'other';
                        
                        totalUses += uses;
                        totalTimeSaved += timeSaved;
                        totalSuccess += successRate;
                        categoryCount[category] = (categoryCount[category] || 0) + 1;
                        
                        skillsData.push({
                            name: s.title,
                            category,
                            uses,
                            successRate: (successRate * 100).toFixed(0) + '%',
                            successValue: successRate * 100,
                            timeSaved: timeSaved.toFixed(0) + 'm',
                            timeSavedValue: timeSaved,
                            status: successRate >= 0.8 ? 'Optimal' : successRate >= 0.6 ? 'Review' : 'Needs Work'
                        });
                    } catch(e) {}
                });
                
                const avgSuccess = skills.length > 0 ? (totalSuccess / skills.length) : 0;
                
                // Update UI
                document.getElementById('total-skills').textContent = skills.length;
                document.getElementById('success-rate').textContent = (avgSuccess * 100).toFixed(0) + '%';
                document.getElementById('success-bar').style.width = (avgSuccess * 100) + '%';
                document.getElementById('time-saved').textContent = (totalTimeSaved / 60).toFixed(1) + 'h';
                document.getElementById('total-docs').textContent = tasks.length;
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
                document.getElementById('status').innerHTML = '‚óè Connected';
                document.getElementById('status').className = 'text-xs text-green-400 mt-1';
                
                // Update table
                const tbody = document.getElementById('skills-table');
                tbody.innerHTML = skillsData.map(s => `
                    <tr class="border-b border-gray-800 hover:bg-gray-800/50 transition-colors">
                        <td class="py-3 font-medium">${s.name}</td>
                        <td class="py-3"><span class="px-2 py-1 bg-gray-700 rounded text-xs uppercase">${s.category}</span></td>
                        <td class="py-3 font-mono">${s.uses}</td>
                        <td class="py-3 font-mono ${s.successValue >= 80 ? 'text-green-400' : s.successValue >= 60 ? 'text-yellow-400' : 'text-red-400'}">${s.successRate}</td>
                        <td class="py-3 font-mono text-purple-400">${s.timeSaved}</td>
                        <td class="py-3">
                            <span class="px-2 py-1 rounded text-xs font-medium ${
                                s.status === 'Optimal' ? 'bg-green-900/50 text-green-300 border border-green-700' :
                                s.status === 'Review' ? 'bg-yellow-900/50 text-yellow-300 border border-yellow-700' :
                                'bg-red-900/50 text-red-300 border border-red-700'
                            }">${s.status}</span>
                        </td>
                    </tr>
                `).join('') || '<tr><td colspan="6" class="py-8 text-center text-gray-500">No skills yet. Start documenting tasks!</td></tr>';
                
                // Update charts
                updateCharts(categoryCount, skillsData);
                
            } catch(e) {
                console.error('Fetch error:', e);
                document.getElementById('status').innerHTML = '‚óè Error';
                document.getElementById('status').className = 'text-xs text-red-400 mt-1';
            }
        }

        function updateCharts(categories, skills) {
            const catLabels = Object.keys(categories).map(c => c.charAt(0).toUpperCase() + c.slice(1));
            const catData = Object.values(categories);
            
            if (categoryChart) categoryChart.destroy();
            categoryChart = new Chart(document.getElementById('categoryChart'), {
                type: 'doughnut',
                data: {
                    labels: catLabels,
                    datasets: [{
                        data: catData,
                        backgroundColor: ['#00ff9f', '#00d4ff', '#ff6b6b', '#ffd93d', '#6c5ce7', '#a29bfe', '#fd79a8'],
                        borderWidth: 0
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'right',
                            labels: { color: '#9ca3af', padding: 15 } 
                        } 
                    }
                }
            });
            
            if (performanceChart) performanceChart.destroy();
            const sortedSkills = [...skills].sort((a, b) => b.uses - a.uses).slice(0, 5);
            performanceChart = new Chart(document.getElementById('performanceChart'), {
                type: 'bar',
                data: {
                    labels: sortedSkills.map(s => s.name.length > 18 ? s.name.substring(0, 18) + '...' : s.name),
                    datasets: [
                        { 
                            label: 'Success %', 
                            data: sortedSkills.map(s => s.successValue), 
                            backgroundColor: 'rgba(0, 255, 159, 0.7)',
                            borderColor: '#00ff9f',
                            borderWidth: 1
                        },
                        { 
                            label: 'Uses', 
                            data: sortedSkills.map(s => s.uses * 5), // Scale for visibility
                            backgroundColor: 'rgba(0, 212, 255, 0.7)',
                            borderColor: '#00d4ff',
                            borderWidth: 1
                        }
                    ]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#9ca3af' } } },
                    scales: { 
                        y: { 
                            grid: { color: 'rgba(55, 65, 81, 0.5)' }, 
                            ticks: { color: '#9ca3af' },
                            beginAtZero: true
                        },
                        x: { 
                            grid: { color: 'rgba(55, 65, 81, 0.5)' }, 
                            ticks: { color: '#9ca3af', maxRotation: 45 } 
                        }
                    }
                }
            });
        }

        // Search filter
        document.getElementById('search').addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('#skills-table tr').forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
            });
        });

        // Initial load and refresh every 30 seconds
        fetchData();
        setInterval(fetchData, 30000);
    </script>
</body>
</html>
